import{w as R}from"./index.9ef37c99.js";import{p as ie}from"./PersistantStore.40321f26.js";import{a1 as x}from"./index.94397499.js";var I=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ve(e){if(e.__esModule)return e;var o=e.default;if(typeof o=="function"){var t=function a(){if(this instanceof a){var p=[null];p.push.apply(p,arguments);var g=Function.bind.apply(o,p);return new g}return o.apply(this,arguments)};t.prototype=o.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(e).forEach(function(a){var p=Object.getOwnPropertyDescriptor(e,a);Object.defineProperty(t,a,p.get?p:{enumerable:!0,get:function(){return e[a]}})}),t}var j={},Ce={get exports(){return j},set exports(e){j=e}},G,X;function ye(){if(X)return G;X=1;var e=1e3,o=e*60,t=o*60,a=t*24,p=a*7,g=a*365.25;G=function(n,r){r=r||{};var f=typeof n;if(f==="string"&&n.length>0)return b(n);if(f==="number"&&isFinite(n))return r.long?l(n):y(n);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(n))};function b(n){if(n=String(n),!(n.length>100)){var r=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(n);if(r){var f=parseFloat(r[1]),d=(r[2]||"ms").toLowerCase();switch(d){case"years":case"year":case"yrs":case"yr":case"y":return f*g;case"weeks":case"week":case"w":return f*p;case"days":case"day":case"d":return f*a;case"hours":case"hour":case"hrs":case"hr":case"h":return f*t;case"minutes":case"minute":case"mins":case"min":case"m":return f*o;case"seconds":case"second":case"secs":case"sec":case"s":return f*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return f;default:return}}}}function y(n){var r=Math.abs(n);return r>=a?Math.round(n/a)+"d":r>=t?Math.round(n/t)+"h":r>=o?Math.round(n/o)+"m":r>=e?Math.round(n/e)+"s":n+"ms"}function l(n){var r=Math.abs(n);return r>=a?u(n,r,a,"day"):r>=t?u(n,r,t,"hour"):r>=o?u(n,r,o,"minute"):r>=e?u(n,r,e,"second"):n+" ms"}function u(n,r,f,d){var v=r>=f*1.5;return Math.round(n/f)+" "+d+(v?"s":"")}return G}function me(e){t.debug=t,t.default=t,t.coerce=l,t.disable=g,t.enable=p,t.enabled=b,t.humanize=ye(),t.destroy=u,Object.keys(e).forEach(n=>{t[n]=e[n]}),t.names=[],t.skips=[],t.formatters={};function o(n){let r=0;for(let f=0;f<n.length;f++)r=(r<<5)-r+n.charCodeAt(f),r|=0;return t.colors[Math.abs(r)%t.colors.length]}t.selectColor=o;function t(n){let r,f=null,d,v;function h(...c){if(!h.enabled)return;const w=h,s=Number(new Date),i=s-(r||s);w.diff=i,w.prev=r,w.curr=s,r=s,c[0]=t.coerce(c[0]),typeof c[0]!="string"&&c.unshift("%O");let C=0;c[0]=c[0].replace(/%([a-zA-Z%])/g,(_,F)=>{if(_==="%%")return"%";C++;const S=t.formatters[F];if(typeof S=="function"){const $=c[C];_=S.call(w,$),c.splice(C,1),C--}return _}),t.formatArgs.call(w,c),(w.log||t.log).apply(w,c)}return h.namespace=n,h.useColors=t.useColors(),h.color=t.selectColor(n),h.extend=a,h.destroy=t.destroy,Object.defineProperty(h,"enabled",{enumerable:!0,configurable:!1,get:()=>f!==null?f:(d!==t.namespaces&&(d=t.namespaces,v=t.enabled(n)),v),set:c=>{f=c}}),typeof t.init=="function"&&t.init(h),h}function a(n,r){const f=t(this.namespace+(typeof r>"u"?":":r)+n);return f.log=this.log,f}function p(n){t.save(n),t.namespaces=n,t.names=[],t.skips=[];let r;const f=(typeof n=="string"?n:"").split(/[\s,]+/),d=f.length;for(r=0;r<d;r++)f[r]&&(n=f[r].replace(/\*/g,".*?"),n[0]==="-"?t.skips.push(new RegExp("^"+n.slice(1)+"$")):t.names.push(new RegExp("^"+n+"$")))}function g(){const n=[...t.names.map(y),...t.skips.map(y).map(r=>"-"+r)].join(",");return t.enable(""),n}function b(n){if(n[n.length-1]==="*")return!0;let r,f;for(r=0,f=t.skips.length;r<f;r++)if(t.skips[r].test(n))return!1;for(r=0,f=t.names.length;r<f;r++)if(t.names[r].test(n))return!0;return!1}function y(n){return n.toString().substring(2,n.toString().length-2).replace(/\.\*\?$/,"*")}function l(n){return n instanceof Error?n.stack||n.message:n}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.enable(t.load()),t}var we=me;(function(e,o){o.formatArgs=a,o.save=p,o.load=g,o.useColors=t,o.storage=b(),o.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),o.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function t(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function a(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let n=0,r=0;l[0].replace(/%[a-zA-Z%]/g,f=>{f!=="%%"&&(n++,f==="%c"&&(r=n))}),l.splice(r,0,u)}o.log=console.debug||console.log||(()=>{});function p(l){try{l?o.storage.setItem("debug",l):o.storage.removeItem("debug")}catch{}}function g(){let l;try{l=o.storage.getItem("debug")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l={}.DEBUG),l}function b(){try{return localStorage}catch{}}e.exports=we(o);const{formatters:y}=e.exports;y.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(Ce,j);const _e=j;var W={},be={get exports(){return W},set exports(e){W=e}};(function(e){var o=Object.prototype.hasOwnProperty,t="~";function a(){}Object.create&&(a.prototype=Object.create(null),new a().__proto__||(t=!1));function p(l,u,n){this.fn=l,this.context=u,this.once=n||!1}function g(l,u,n,r,f){if(typeof n!="function")throw new TypeError("The listener must be a function");var d=new p(n,r||l,f),v=t?t+u:u;return l._events[v]?l._events[v].fn?l._events[v]=[l._events[v],d]:l._events[v].push(d):(l._events[v]=d,l._eventsCount++),l}function b(l,u){--l._eventsCount===0?l._events=new a:delete l._events[u]}function y(){this._events=new a,this._eventsCount=0}y.prototype.eventNames=function(){var u=[],n,r;if(this._eventsCount===0)return u;for(r in n=this._events)o.call(n,r)&&u.push(t?r.slice(1):r);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(n)):u},y.prototype.listeners=function(u){var n=t?t+u:u,r=this._events[n];if(!r)return[];if(r.fn)return[r.fn];for(var f=0,d=r.length,v=new Array(d);f<d;f++)v[f]=r[f].fn;return v},y.prototype.listenerCount=function(u){var n=t?t+u:u,r=this._events[n];return r?r.fn?1:r.length:0},y.prototype.emit=function(u,n,r,f,d,v){var h=t?t+u:u;if(!this._events[h])return!1;var c=this._events[h],w=arguments.length,s,i;if(c.fn){switch(c.once&&this.removeListener(u,c.fn,void 0,!0),w){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,n),!0;case 3:return c.fn.call(c.context,n,r),!0;case 4:return c.fn.call(c.context,n,r,f),!0;case 5:return c.fn.call(c.context,n,r,f,d),!0;case 6:return c.fn.call(c.context,n,r,f,d,v),!0}for(i=1,s=new Array(w-1);i<w;i++)s[i-1]=arguments[i];c.fn.apply(c.context,s)}else{var C=c.length,m;for(i=0;i<C;i++)switch(c[i].once&&this.removeListener(u,c[i].fn,void 0,!0),w){case 1:c[i].fn.call(c[i].context);break;case 2:c[i].fn.call(c[i].context,n);break;case 3:c[i].fn.call(c[i].context,n,r);break;case 4:c[i].fn.call(c[i].context,n,r,f);break;default:if(!s)for(m=1,s=new Array(w-1);m<w;m++)s[m-1]=arguments[m];c[i].fn.apply(c[i].context,s)}}return!0},y.prototype.on=function(u,n,r){return g(this,u,n,r,!1)},y.prototype.once=function(u,n,r){return g(this,u,n,r,!0)},y.prototype.removeListener=function(u,n,r,f){var d=t?t+u:u;if(!this._events[d])return this;if(!n)return b(this,d),this;var v=this._events[d];if(v.fn)v.fn===n&&(!f||v.once)&&(!r||v.context===r)&&b(this,d);else{for(var h=0,c=[],w=v.length;h<w;h++)(v[h].fn!==n||f&&!v[h].once||r&&v[h].context!==r)&&c.push(v[h]);c.length?this._events[d]=c.length===1?c[0]:c:b(this,d)}return this},y.prototype.removeAllListeners=function(u){var n;return u?(n=t?t+u:u,this._events[n]&&b(this,n)):(this._events=new a,this._eventsCount=0),this},y.prototype.off=y.prototype.removeListener,y.prototype.addListener=y.prototype.on,y.prefixed=t,y.EventEmitter=y,e.exports=y})(be);var N=null;typeof WebSocket<"u"?N=WebSocket:typeof MozWebSocket<"u"?N=MozWebSocket:typeof I<"u"?N=I.WebSocket||I.MozWebSocket:typeof window<"u"?N=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(N=self.WebSocket||self.MozWebSocket);var Y=N,K={},Fe={get exports(){return K},set exports(e){K=e}};function Ee(e){throw new Error('Could not dynamically require "'+e+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var V={},Pe={get exports(){return V},set exports(e){V=e}};const Se={},$e=Object.freeze(Object.defineProperty({__proto__:null,default:Se},Symbol.toStringTag,{value:"Module"})),xe=ve($e);var ee;function ae(){return ee||(ee=1,function(e,o){(function(t,a){e.exports=a()})(I,function(){var t=t||function(a,p){var g;if(typeof window<"u"&&window.crypto&&(g=window.crypto),typeof self<"u"&&self.crypto&&(g=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(g=globalThis.crypto),!g&&typeof window<"u"&&window.msCrypto&&(g=window.msCrypto),!g&&typeof I<"u"&&I.crypto&&(g=I.crypto),!g&&typeof Ee=="function")try{g=xe}catch{}var b=function(){if(g){if(typeof g.getRandomValues=="function")try{return g.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof g.randomBytes=="function")try{return g.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},y=Object.create||function(){function s(){}return function(i){var C;return s.prototype=i,C=new s,s.prototype=null,C}}(),l={},u=l.lib={},n=u.Base=function(){return{extend:function(s){var i=y(this);return s&&i.mixIn(s),(!i.hasOwnProperty("init")||this.init===i.init)&&(i.init=function(){i.$super.init.apply(this,arguments)}),i.init.prototype=i,i.$super=this,i},create:function(){var s=this.extend();return s.init.apply(s,arguments),s},init:function(){},mixIn:function(s){for(var i in s)s.hasOwnProperty(i)&&(this[i]=s[i]);s.hasOwnProperty("toString")&&(this.toString=s.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),r=u.WordArray=n.extend({init:function(s,i){s=this.words=s||[],i!=p?this.sigBytes=i:this.sigBytes=s.length*4},toString:function(s){return(s||d).stringify(this)},concat:function(s){var i=this.words,C=s.words,m=this.sigBytes,_=s.sigBytes;if(this.clamp(),m%4)for(var F=0;F<_;F++){var S=C[F>>>2]>>>24-F%4*8&255;i[m+F>>>2]|=S<<24-(m+F)%4*8}else for(var $=0;$<_;$+=4)i[m+$>>>2]=C[$>>>2];return this.sigBytes+=_,this},clamp:function(){var s=this.words,i=this.sigBytes;s[i>>>2]&=4294967295<<32-i%4*8,s.length=a.ceil(i/4)},clone:function(){var s=n.clone.call(this);return s.words=this.words.slice(0),s},random:function(s){for(var i=[],C=0;C<s;C+=4)i.push(b());return new r.init(i,s)}}),f=l.enc={},d=f.Hex={stringify:function(s){for(var i=s.words,C=s.sigBytes,m=[],_=0;_<C;_++){var F=i[_>>>2]>>>24-_%4*8&255;m.push((F>>>4).toString(16)),m.push((F&15).toString(16))}return m.join("")},parse:function(s){for(var i=s.length,C=[],m=0;m<i;m+=2)C[m>>>3]|=parseInt(s.substr(m,2),16)<<24-m%8*4;return new r.init(C,i/2)}},v=f.Latin1={stringify:function(s){for(var i=s.words,C=s.sigBytes,m=[],_=0;_<C;_++){var F=i[_>>>2]>>>24-_%4*8&255;m.push(String.fromCharCode(F))}return m.join("")},parse:function(s){for(var i=s.length,C=[],m=0;m<i;m++)C[m>>>2]|=(s.charCodeAt(m)&255)<<24-m%4*8;return new r.init(C,i)}},h=f.Utf8={stringify:function(s){try{return decodeURIComponent(escape(v.stringify(s)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(s){return v.parse(unescape(encodeURIComponent(s)))}},c=u.BufferedBlockAlgorithm=n.extend({reset:function(){this._data=new r.init,this._nDataBytes=0},_append:function(s){typeof s=="string"&&(s=h.parse(s)),this._data.concat(s),this._nDataBytes+=s.sigBytes},_process:function(s){var i,C=this._data,m=C.words,_=C.sigBytes,F=this.blockSize,S=F*4,$=_/S;s?$=a.ceil($):$=a.max(($|0)-this._minBufferSize,0);var k=$*F,A=a.min(k*4,_);if(k){for(var M=0;M<k;M+=F)this._doProcessBlock(m,M);i=m.splice(0,k),C.sigBytes-=A}return new r.init(i,A)},clone:function(){var s=n.clone.call(this);return s._data=this._data.clone(),s},_minBufferSize:0});u.Hasher=c.extend({cfg:n.extend(),init:function(s){this.cfg=this.cfg.extend(s),this.reset()},reset:function(){c.reset.call(this),this._doReset()},update:function(s){return this._append(s),this._process(),this},finalize:function(s){s&&this._append(s);var i=this._doFinalize();return i},blockSize:16,_createHelper:function(s){return function(i,C){return new s.init(C).finalize(i)}},_createHmacHelper:function(s){return function(i,C){return new w.HMAC.init(s,C).finalize(i)}}});var w=l.algo={};return l}(Math);return t})}(Pe)),V}(function(e,o){(function(t,a){e.exports=a(ae())})(I,function(t){return function(a){var p=t,g=p.lib,b=g.WordArray,y=g.Hasher,l=p.algo,u=[],n=[];(function(){function d(w){for(var s=a.sqrt(w),i=2;i<=s;i++)if(!(w%i))return!1;return!0}function v(w){return(w-(w|0))*4294967296|0}for(var h=2,c=0;c<64;)d(h)&&(c<8&&(u[c]=v(a.pow(h,1/2))),n[c]=v(a.pow(h,1/3)),c++),h++})();var r=[],f=l.SHA256=y.extend({_doReset:function(){this._hash=new b.init(u.slice(0))},_doProcessBlock:function(d,v){for(var h=this._hash.words,c=h[0],w=h[1],s=h[2],i=h[3],C=h[4],m=h[5],_=h[6],F=h[7],S=0;S<64;S++){if(S<16)r[S]=d[v+S]|0;else{var $=r[S-15],k=($<<25|$>>>7)^($<<14|$>>>18)^$>>>3,A=r[S-2],M=(A<<15|A>>>17)^(A<<13|A>>>19)^A>>>10;r[S]=k+r[S-7]+M+r[S-16]}var le=C&m^~C&_,de=c&w^c&s^w&s,he=(c<<30|c>>>2)^(c<<19|c>>>13)^(c<<10|c>>>22),ge=(C<<26|C>>>6)^(C<<21|C>>>11)^(C<<7|C>>>25),Q=F+ge+le+n[S]+r[S],pe=he+de;F=_,_=m,m=C,C=i+Q|0,i=s,s=w,w=c,c=Q+pe|0}h[0]=h[0]+c|0,h[1]=h[1]+w|0,h[2]=h[2]+s|0,h[3]=h[3]+i|0,h[4]=h[4]+C|0,h[5]=h[5]+m|0,h[6]=h[6]+_|0,h[7]=h[7]+F|0},_doFinalize:function(){var d=this._data,v=d.words,h=this._nDataBytes*8,c=d.sigBytes*8;return v[c>>>5]|=128<<24-c%32,v[(c+64>>>9<<4)+14]=a.floor(h/4294967296),v[(c+64>>>9<<4)+15]=h,d.sigBytes=v.length*4,this._process(),this._hash},clone:function(){var d=y.clone.call(this);return d._hash=this._hash.clone(),d}});p.SHA256=y._createHelper(f),p.HmacSHA256=y._createHmacHelper(f)}(Math),t.SHA256})})(Fe);const te=K;var J={},Oe={get exports(){return J},set exports(e){J=e}};(function(e,o){(function(t,a){e.exports=a(ae())})(I,function(t){return function(){var a=t,p=a.lib,g=p.WordArray,b=a.enc;b.Base64={stringify:function(l){var u=l.words,n=l.sigBytes,r=this._map;l.clamp();for(var f=[],d=0;d<n;d+=3)for(var v=u[d>>>2]>>>24-d%4*8&255,h=u[d+1>>>2]>>>24-(d+1)%4*8&255,c=u[d+2>>>2]>>>24-(d+2)%4*8&255,w=v<<16|h<<8|c,s=0;s<4&&d+s*.75<n;s++)f.push(r.charAt(w>>>6*(3-s)&63));var i=r.charAt(64);if(i)for(;f.length%4;)f.push(i);return f.join("")},parse:function(l){var u=l.length,n=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var f=0;f<n.length;f++)r[n.charCodeAt(f)]=f}var d=n.charAt(64);if(d){var v=l.indexOf(d);v!==-1&&(u=v)}return y(l,u,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function y(l,u,n){for(var r=[],f=0,d=0;d<u;d++)if(d%4){var v=n[l.charCodeAt(d-1)]<<d%4*2,h=n[l.charCodeAt(d)]>>>6-d%4*2,c=v|h;r[f>>>2]|=c<<24-f%4*8,f++}return g.create(r,f)}}(),t.enc.Base64})})(Oe);const ne=J;function q(){return q=Object.assign?Object.assign.bind():function(e){for(var o=1;o<arguments.length;o++){var t=arguments[o];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},q.apply(this,arguments)}function Be(e,o){if(e==null)return{};var t={},a=Object.keys(e),p,g;for(g=0;g<a.length;g++)p=a[g],!(o.indexOf(p)>=0)&&(t[p]=e[p]);return t}var O;(function(e){e[e.Hello=0]="Hello",e[e.Identify=1]="Identify",e[e.Identified=2]="Identified",e[e.Reidentify=3]="Reidentify",e[e.Event=5]="Event",e[e.Request=6]="Request",e[e.RequestResponse=7]="RequestResponse",e[e.RequestBatch=8]="RequestBatch",e[e.RequestBatchResponse=9]="RequestBatchResponse"})(O||(O={}));var re;(function(e){e[e.None=0]="None",e[e.General=1]="General",e[e.Config=2]="Config",e[e.Scenes=4]="Scenes",e[e.Inputs=8]="Inputs",e[e.Transitions=16]="Transitions",e[e.Filters=32]="Filters",e[e.Outputs=64]="Outputs",e[e.SceneItems=128]="SceneItems",e[e.MediaInputs=256]="MediaInputs",e[e.Vendors=512]="Vendors",e[e.Ui=1024]="Ui",e[e.All=1023]="All",e[e.InputVolumeMeters=65536]="InputVolumeMeters",e[e.InputActiveStateChanged=131072]="InputActiveStateChanged",e[e.InputShowStateChanged=262144]="InputShowStateChanged",e[e.SceneItemTransformChanged=524288]="SceneItemTransformChanged"})(re||(re={}));var se;(function(e){e[e.None=-1]="None",e[e.SerialRealtime=0]="SerialRealtime",e[e.SerialFrame=1]="SerialFrame",e[e.Parallel=2]="Parallel"})(se||(se={}));function Te(e,o,t){const a=ne.stringify(te(t+e));return ne.stringify(te(a+o))}const Ie=["authentication","rpcVersion"],U=_e("obs-websocket-js");class H extends Error{constructor(o,t){super(t),this.code=void 0,this.code=o}}class L extends W{constructor(...o){super(...o),this._identified=!1,this.internalListeners=new W,this.socket=void 0}static generateMessageId(){return String(L.requestCounter++)}get identified(){return this._identified}async connect(o="ws://127.0.0.1:4455",t,a={}){var p=this;this.socket&&await this.disconnect();try{const g=this.internalEventPromise("ConnectionClosed"),b=this.internalEventPromise("ConnectionError");return await Promise.race([async function(){const y=await p.createConnection(o);return p.emit("Hello",y),p.identify(y,t,a)}(),new Promise((y,l)=>{b.then(u=>{u.message&&l(u)}),g.then(u=>{l(u)})})])}catch(g){throw await this.disconnect(),g}}async disconnect(){if(!this.socket||this.socket.readyState===Y.CLOSED)return;const o=this.internalEventPromise("ConnectionClosed");this.socket.close(),await o}async reidentify(o){const t=this.internalEventPromise(`op:${O.Identified}`);return await this.message(O.Reidentify,o),t}async call(o,t){const a=L.generateMessageId(),p=this.internalEventPromise(`res:${a}`);await this.message(O.Request,{requestId:a,requestType:o,requestData:t});const{requestStatus:g,responseData:b}=await p;if(!g.result)throw new H(g.code,g.comment);return b}async callBatch(o,t={}){const a=L.generateMessageId(),p=this.internalEventPromise(`res:${a}`);await this.message(O.RequestBatch,q({requestId:a,requests:o},t));const{results:g}=await p;return g}cleanup(){this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket=void 0,this._identified=!1,this.internalListeners.removeAllListeners())}async createConnection(o){var t;const a=this.internalEventPromise("ConnectionOpened"),p=this.internalEventPromise(`op:${O.Hello}`);this.socket=new Y(o,this.protocol),this.socket.onopen=this.onOpen.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this),this.socket.onclose=this.onClose.bind(this),await a;const g=(t=this.socket)==null?void 0:t.protocol;if(!g)throw new H(-1,"Server sent no subprotocol");if(g!==this.protocol)throw new H(-1,"Server sent an invalid subprotocol");return p}async identify(o,t,a={}){let{authentication:p,rpcVersion:g}=o,b=Be(o,Ie);const y=q({rpcVersion:g},a);p&&t&&(y.authentication=Te(p.salt,p.challenge,t));const l=this.internalEventPromise(`op:${O.Identified}`);await this.message(O.Identify,y);const u=await l;return this._identified=!0,this.emit("Identified",u),q({rpcVersion:g},b,u)}async message(o,t){if(!this.socket)throw new Error("Not connected");if(!this.identified&&o!==1)throw new Error("Socket not identified");const a=await this.encodeMessage({op:o,d:t});this.socket.send(a)}async internalEventPromise(o){return new Promise(t=>{this.internalListeners.once(o,t)})}onOpen(o){U("socket.open"),this.emit("ConnectionOpened"),this.internalListeners.emit("ConnectionOpened",o)}async onMessage(o){try{const{op:t,d:a}=await this.decodeMessage(o.data);if(U("socket.message: %d %j",t,a),t===void 0||a===void 0)return;switch(t){case O.Event:{const{eventType:p,eventData:g}=a;this.emit(p,g);return}case O.RequestResponse:case O.RequestBatchResponse:{const{requestId:p}=a;this.internalListeners.emit(`res:${p}`,a);return}default:this.internalListeners.emit(`op:${t}`,a)}}catch(t){U("error handling message: %o",t)}}onError(o){U("socket.error: %o",o);const t=new H(-1,o.message);this.emit("ConnectionError",t),this.internalListeners.emit("ConnectionError",t)}onClose(o){U("socket.close: %s (%d)",o.reason,o.code);const t=new H(o.code,o.reason);this.emit("ConnectionClosed",t),this.internalListeners.emit("ConnectionClosed",t),this.cleanup()}}L.requestCounter=1;typeof exports<"u"&&Object.defineProperty(exports,"__esModule",{value:!0});class Ae extends L{constructor(...o){super(...o),this.protocol="obswebsocket.json"}async encodeMessage(o){return JSON.stringify(o)}async decodeMessage(o){return JSON.parse(o)}}const T="(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)(?:\\.(?:25[0-5]|2[0-4]\\d|1\\d\\d|[1-9]\\d|\\d)){3}",E="[a-fA-F\\d]{1,4}",z=`
(?:
(?:${E}:){7}(?:${E}|:)|                                   
(?:${E}:){6}(?:${T}|:${E}|:)|                             
(?:${E}:){5}(?::${T}|(?::${E}){1,2}|:)|                   
(?:${E}:){4}(?:(?::${E}){0,1}:${T}|(?::${E}){1,3}|:)| 
(?:${E}:){3}(?:(?::${E}){0,2}:${T}|(?::${E}){1,4}|:)| 
(?:${E}:){2}(?:(?::${E}){0,3}:${T}|(?::${E}){1,5}|:)| 
(?:${E}:){1}(?:(?::${E}){0,4}:${T}|(?::${E}){1,6}|:)| 
(?::(?:(?::${E}){0,5}:${T}|(?::${E}){1,7}|:))            
)(?:%[0-9a-zA-Z]{1,})?|(::d)                                            
`.replace(/\s*\/\/.*$/gm,"").replace(/\n/g,"").trim();var Re={isIPAddress(e){return new RegExp(`(?:^${T}$)|(?:^${z}$)`).test(e.toString())},isIPV4Address(e){return new RegExp(`^${T}$`).test(e.toString())},isIPV6Address(e){return new RegExp(`^${z}$`).test(e.toString())},ipVersion(e){return new RegExp(`(?:^${T}$)|(?:^${z}$)`).test(e.toString())?new RegExp(`^${z}$`).test(e.toString())?6:4:"Please enter valid IP address"}},ke=(e=>(e.Stopped="OBS_WEBSOCKET_OUTPUT_STOPPED",e.Starting="OBS_WEBSOCKET_OUTPUT_STARTING",e.Started="OBS_WEBSOCKET_OUTPUT_STARTED",e.Stopping="OBS_WEBSOCKET_OUTPUT_STOPPING",e))(ke||{}),Ne=(e=>(e.Disconnected="DISCONNECTED",e.Connecting="CONNECTING",e.Connected="CONNECTED",e.Disconnecting="DISCONNECTING",e))(Ne||{});const oe=ie("obsStatusLog","",{storage:"session"}),B=ie("sl_obs",new Ae,{storage:"local"}),Le=R(""),De=R(""),Me=R(""),Z=R(!1),D=R("DISCONNECTED"),ce=R("OBS_WEBSOCKET_OUTPUT_STOPPED"),fe=R("OBS_WEBSOCKET_OUTPUT_STOPPED"),ue=R("?");x(B).addListener("Identified",async()=>{Z.set(!0),D.set("CONNECTED");const{outputActive:e}=await x(B).call("GetRecordStatus"),{outputActive:o}=await x(B).call("GetStreamStatus"),{currentProgramSceneName:t}=await x(B).call("GetCurrentProgramScene");ue.set(t),ce.set(e?"OBS_WEBSOCKET_OUTPUT_STARTED":"OBS_WEBSOCKET_OUTPUT_STOPPED"),fe.set(o?"OBS_WEBSOCKET_OUTPUT_STARTED":"OBS_WEBSOCKET_OUTPUT_STOPPED")});x(B).addListener("ConnectionClosed",e=>{switch(Z.set(!1),D.set("DISCONNECTED"),e.code){case 1e3:P("Closing connection successful");break;case 1001:P("Closing connection due to websocket server is going down or browsewr navigated away from page.");break;default:P("Connection-Closed:"),P(`Error-Code: ${e.code}`),e.message&&P(`Error-Message: ${e.message}`);break}});x(B).addListener("ConnectionError",e=>{Z.set(!1),D.set("DISCONNECTED"),e.code==-1?P("No compatible server was found!"):(P("Connection-Error:"),P(`Error-Code: ${e.code}`),e.message&&P(`Error-Message: ${e.message}`))});x(B).addListener("CurrentProgramSceneChanged",({sceneName:e})=>{ue.set(e)});x(B).addListener("StreamStateChanged",({outputActive:e,outputState:o})=>{fe.set(o)});x(B).addListener("RecordStateChanged",({outputActive:e,outputState:o})=>{ce.set(o)});async function ze(){let e=x(Le),o=x(De),t=x(Me);try{Re.isIPV6Address(e)&&(e=`[${e}]`);const a=`ws://${e}:${o}`;P(`Try connect to server: ${a}`),D.set("CONNECTING");const{obsWebSocketVersion:p,negotiatedRpcVersion:g}=await x(B).connect(a,t,{rpcVersion:1});P("Connected to the OBS-WebSocket-Server"),P(`Version: ${p}`),P(`RPC: ${g}`)}catch(a){P("Failed to connect"),P(`Error-Code: ${a.code}`),a.message&&P(`Error-Message: ${a.message}`)}}async function je(){try{D.set("DISCONNECTING"),await x(B).disconnect(),P("Disconnected.")}catch(e){D.set("CONNECTED"),P("Failed to disconnect"),P(`Error-Code: ${e.code}`),P(`Error-Message: ${e.message}`)}}function P(e){const o=new Date().toLocaleTimeString("de-de",{timeStyle:"medium"});oe.set(x(oe)+`${o} | ${e}
`)}export{ze as C,je as D,Ne as O,ke as a,Z as b,ue as c,ce as d,fe as e,Me as f,De as g,Le as h,Re as i,oe as j,D as o};
