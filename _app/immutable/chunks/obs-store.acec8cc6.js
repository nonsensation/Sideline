import{w as Z}from"./index.182b4091.js";var P=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function re(n){if(n.__esModule)return n;var i=n.default;if(typeof i=="function"){var e=function f(){if(this instanceof f){var p=[null];p.push.apply(p,arguments);var v=Function.bind.apply(i,p);return new v}return i.apply(this,arguments)};e.prototype=i.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(n).forEach(function(f){var p=Object.getOwnPropertyDescriptor(n,f);Object.defineProperty(e,f,p.get?p:{enumerable:!0,get:function(){return n[f]}})}),e}var z={},se={get exports(){return z},set exports(n){z=n}},E,T;function oe(){if(T)return E;T=1;var n=1e3,i=n*60,e=i*60,f=e*24,p=f*7,v=f*365.25;E=function(t,r){r=r||{};var c=typeof t;if(c==="string"&&t.length>0)return F(t);if(c==="number"&&isFinite(t))return r.long?l(t):C(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))};function F(t){if(t=String(t),!(t.length>100)){var r=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(r){var c=parseFloat(r[1]),d=(r[2]||"ms").toLowerCase();switch(d){case"years":case"year":case"yrs":case"yr":case"y":return c*v;case"weeks":case"week":case"w":return c*p;case"days":case"day":case"d":return c*f;case"hours":case"hour":case"hrs":case"hr":case"h":return c*e;case"minutes":case"minute":case"mins":case"min":case"m":return c*i;case"seconds":case"second":case"secs":case"sec":case"s":return c*n;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return c;default:return}}}}function C(t){var r=Math.abs(t);return r>=f?Math.round(t/f)+"d":r>=e?Math.round(t/e)+"h":r>=i?Math.round(t/i)+"m":r>=n?Math.round(t/n)+"s":t+"ms"}function l(t){var r=Math.abs(t);return r>=f?u(t,r,f,"day"):r>=e?u(t,r,e,"hour"):r>=i?u(t,r,i,"minute"):r>=n?u(t,r,n,"second"):t+" ms"}function u(t,r,c,d){var g=r>=c*1.5;return Math.round(t/c)+" "+d+(g?"s":"")}return E}function ie(n){e.debug=e,e.default=e,e.coerce=l,e.disable=v,e.enable=p,e.enabled=F,e.humanize=oe(),e.destroy=u,Object.keys(n).forEach(t=>{e[t]=n[t]}),e.names=[],e.skips=[],e.formatters={};function i(t){let r=0;for(let c=0;c<t.length;c++)r=(r<<5)-r+t.charCodeAt(c),r|=0;return e.colors[Math.abs(r)%e.colors.length]}e.selectColor=i;function e(t){let r,c=null,d,g;function h(...a){if(!h.enabled)return;const w=h,s=Number(new Date),o=s-(r||s);w.diff=o,w.prev=r,w.curr=s,r=s,a[0]=e.coerce(a[0]),typeof a[0]!="string"&&a.unshift("%O");let y=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,(_,b)=>{if(_==="%%")return"%";y++;const x=e.formatters[b];if(typeof x=="function"){const B=a[y];_=x.call(w,B),a.splice(y,1),y--}return _}),e.formatArgs.call(w,a),(w.log||e.log).apply(w,a)}return h.namespace=t,h.useColors=e.useColors(),h.color=e.selectColor(t),h.extend=f,h.destroy=e.destroy,Object.defineProperty(h,"enabled",{enumerable:!0,configurable:!1,get:()=>c!==null?c:(d!==e.namespaces&&(d=e.namespaces,g=e.enabled(t)),g),set:a=>{c=a}}),typeof e.init=="function"&&e.init(h),h}function f(t,r){const c=e(this.namespace+(typeof r>"u"?":":r)+t);return c.log=this.log,c}function p(t){e.save(t),e.namespaces=t,e.names=[],e.skips=[];let r;const c=(typeof t=="string"?t:"").split(/[\s,]+/),d=c.length;for(r=0;r<d;r++)c[r]&&(t=c[r].replace(/\*/g,".*?"),t[0]==="-"?e.skips.push(new RegExp("^"+t.slice(1)+"$")):e.names.push(new RegExp("^"+t+"$")))}function v(){const t=[...e.names.map(C),...e.skips.map(C).map(r=>"-"+r)].join(",");return e.enable(""),t}function F(t){if(t[t.length-1]==="*")return!0;let r,c;for(r=0,c=e.skips.length;r<c;r++)if(e.skips[r].test(t))return!1;for(r=0,c=e.names.length;r<c;r++)if(e.names[r].test(t))return!0;return!1}function C(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}function l(t){return t instanceof Error?t.stack||t.message:t}function u(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return e.enable(e.load()),e}var ae=ie;(function(n,i){i.formatArgs=f,i.save=p,i.load=v,i.useColors=e,i.storage=F(),i.destroy=(()=>{let l=!1;return()=>{l||(l=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),i.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function e(){return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/)?!1:typeof document<"u"&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)}function f(l){if(l[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+l[0]+(this.useColors?"%c ":" ")+"+"+n.exports.humanize(this.diff),!this.useColors)return;const u="color: "+this.color;l.splice(1,0,u,"color: inherit");let t=0,r=0;l[0].replace(/%[a-zA-Z%]/g,c=>{c!=="%%"&&(t++,c==="%c"&&(r=t))}),l.splice(r,0,u)}i.log=console.debug||console.log||(()=>{});function p(l){try{l?i.storage.setItem("debug",l):i.storage.removeItem("debug")}catch{}}function v(){let l;try{l=i.storage.getItem("debug")}catch{}return!l&&typeof process<"u"&&"env"in process&&(l={}.DEBUG),l}function F(){try{return localStorage}catch{}}n.exports=ae(i);const{formatters:C}=n.exports;C.j=function(l){try{return JSON.stringify(l)}catch(u){return"[UnexpectedJSONParseError]: "+u.message}}})(se,z);const ce=z;var j={},fe={get exports(){return j},set exports(n){j=n}};(function(n){var i=Object.prototype.hasOwnProperty,e="~";function f(){}Object.create&&(f.prototype=Object.create(null),new f().__proto__||(e=!1));function p(l,u,t){this.fn=l,this.context=u,this.once=t||!1}function v(l,u,t,r,c){if(typeof t!="function")throw new TypeError("The listener must be a function");var d=new p(t,r||l,c),g=e?e+u:u;return l._events[g]?l._events[g].fn?l._events[g]=[l._events[g],d]:l._events[g].push(d):(l._events[g]=d,l._eventsCount++),l}function F(l,u){--l._eventsCount===0?l._events=new f:delete l._events[u]}function C(){this._events=new f,this._eventsCount=0}C.prototype.eventNames=function(){var u=[],t,r;if(this._eventsCount===0)return u;for(r in t=this._events)i.call(t,r)&&u.push(e?r.slice(1):r);return Object.getOwnPropertySymbols?u.concat(Object.getOwnPropertySymbols(t)):u},C.prototype.listeners=function(u){var t=e?e+u:u,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var c=0,d=r.length,g=new Array(d);c<d;c++)g[c]=r[c].fn;return g},C.prototype.listenerCount=function(u){var t=e?e+u:u,r=this._events[t];return r?r.fn?1:r.length:0},C.prototype.emit=function(u,t,r,c,d,g){var h=e?e+u:u;if(!this._events[h])return!1;var a=this._events[h],w=arguments.length,s,o;if(a.fn){switch(a.once&&this.removeListener(u,a.fn,void 0,!0),w){case 1:return a.fn.call(a.context),!0;case 2:return a.fn.call(a.context,t),!0;case 3:return a.fn.call(a.context,t,r),!0;case 4:return a.fn.call(a.context,t,r,c),!0;case 5:return a.fn.call(a.context,t,r,c,d),!0;case 6:return a.fn.call(a.context,t,r,c,d,g),!0}for(o=1,s=new Array(w-1);o<w;o++)s[o-1]=arguments[o];a.fn.apply(a.context,s)}else{var y=a.length,m;for(o=0;o<y;o++)switch(a[o].once&&this.removeListener(u,a[o].fn,void 0,!0),w){case 1:a[o].fn.call(a[o].context);break;case 2:a[o].fn.call(a[o].context,t);break;case 3:a[o].fn.call(a[o].context,t,r);break;case 4:a[o].fn.call(a[o].context,t,r,c);break;default:if(!s)for(m=1,s=new Array(w-1);m<w;m++)s[m-1]=arguments[m];a[o].fn.apply(a[o].context,s)}}return!0},C.prototype.on=function(u,t,r){return v(this,u,t,r,!1)},C.prototype.once=function(u,t,r){return v(this,u,t,r,!0)},C.prototype.removeListener=function(u,t,r,c){var d=e?e+u:u;if(!this._events[d])return this;if(!t)return F(this,d),this;var g=this._events[d];if(g.fn)g.fn===t&&(!c||g.once)&&(!r||g.context===r)&&F(this,d);else{for(var h=0,a=[],w=g.length;h<w;h++)(g[h].fn!==t||c&&!g[h].once||r&&g[h].context!==r)&&a.push(g[h]);a.length?this._events[d]=a.length===1?a[0]:a:F(this,d)}return this},C.prototype.removeAllListeners=function(u){var t;return u?(t=e?e+u:u,this._events[t]&&F(this,t)):(this._events=new f,this._eventsCount=0),this},C.prototype.off=C.prototype.removeListener,C.prototype.addListener=C.prototype.on,C.prefixed=e,C.EventEmitter=C,n.exports=C})(fe);var R=null;typeof WebSocket<"u"?R=WebSocket:typeof MozWebSocket<"u"?R=MozWebSocket:typeof P<"u"?R=P.WebSocket||P.MozWebSocket:typeof window<"u"?R=window.WebSocket||window.MozWebSocket:typeof self<"u"&&(R=self.WebSocket||self.MozWebSocket);var U=R,S={},ue={get exports(){return S},set exports(n){S=n}};function le(n){throw new Error('Could not dynamically require "'+n+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var $={},de={get exports(){return $},set exports(n){$=n}};const he={},ve=Object.freeze(Object.defineProperty({__proto__:null,default:he},Symbol.toStringTag,{value:"Module"})),pe=re(ve);var W;function Q(){return W||(W=1,function(n,i){(function(e,f){n.exports=f()})(P,function(){var e=e||function(f,p){var v;if(typeof window<"u"&&window.crypto&&(v=window.crypto),typeof self<"u"&&self.crypto&&(v=self.crypto),typeof globalThis<"u"&&globalThis.crypto&&(v=globalThis.crypto),!v&&typeof window<"u"&&window.msCrypto&&(v=window.msCrypto),!v&&typeof P<"u"&&P.crypto&&(v=P.crypto),!v&&typeof le=="function")try{v=pe}catch{}var F=function(){if(v){if(typeof v.getRandomValues=="function")try{return v.getRandomValues(new Uint32Array(1))[0]}catch{}if(typeof v.randomBytes=="function")try{return v.randomBytes(4).readInt32LE()}catch{}}throw new Error("Native crypto module could not be used to get secure random number.")},C=Object.create||function(){function s(){}return function(o){var y;return s.prototype=o,y=new s,s.prototype=null,y}}(),l={},u=l.lib={},t=u.Base=function(){return{extend:function(s){var o=C(this);return s&&o.mixIn(s),(!o.hasOwnProperty("init")||this.init===o.init)&&(o.init=function(){o.$super.init.apply(this,arguments)}),o.init.prototype=o,o.$super=this,o},create:function(){var s=this.extend();return s.init.apply(s,arguments),s},init:function(){},mixIn:function(s){for(var o in s)s.hasOwnProperty(o)&&(this[o]=s[o]);s.hasOwnProperty("toString")&&(this.toString=s.toString)},clone:function(){return this.init.prototype.extend(this)}}}(),r=u.WordArray=t.extend({init:function(s,o){s=this.words=s||[],o!=p?this.sigBytes=o:this.sigBytes=s.length*4},toString:function(s){return(s||d).stringify(this)},concat:function(s){var o=this.words,y=s.words,m=this.sigBytes,_=s.sigBytes;if(this.clamp(),m%4)for(var b=0;b<_;b++){var x=y[b>>>2]>>>24-b%4*8&255;o[m+b>>>2]|=x<<24-(m+b)%4*8}else for(var B=0;B<_;B+=4)o[m+B>>>2]=y[B>>>2];return this.sigBytes+=_,this},clamp:function(){var s=this.words,o=this.sigBytes;s[o>>>2]&=4294967295<<32-o%4*8,s.length=f.ceil(o/4)},clone:function(){var s=t.clone.call(this);return s.words=this.words.slice(0),s},random:function(s){for(var o=[],y=0;y<s;y+=4)o.push(F());return new r.init(o,s)}}),c=l.enc={},d=c.Hex={stringify:function(s){for(var o=s.words,y=s.sigBytes,m=[],_=0;_<y;_++){var b=o[_>>>2]>>>24-_%4*8&255;m.push((b>>>4).toString(16)),m.push((b&15).toString(16))}return m.join("")},parse:function(s){for(var o=s.length,y=[],m=0;m<o;m+=2)y[m>>>3]|=parseInt(s.substr(m,2),16)<<24-m%8*4;return new r.init(y,o/2)}},g=c.Latin1={stringify:function(s){for(var o=s.words,y=s.sigBytes,m=[],_=0;_<y;_++){var b=o[_>>>2]>>>24-_%4*8&255;m.push(String.fromCharCode(b))}return m.join("")},parse:function(s){for(var o=s.length,y=[],m=0;m<o;m++)y[m>>>2]|=(s.charCodeAt(m)&255)<<24-m%4*8;return new r.init(y,o)}},h=c.Utf8={stringify:function(s){try{return decodeURIComponent(escape(g.stringify(s)))}catch{throw new Error("Malformed UTF-8 data")}},parse:function(s){return g.parse(unescape(encodeURIComponent(s)))}},a=u.BufferedBlockAlgorithm=t.extend({reset:function(){this._data=new r.init,this._nDataBytes=0},_append:function(s){typeof s=="string"&&(s=h.parse(s)),this._data.concat(s),this._nDataBytes+=s.sigBytes},_process:function(s){var o,y=this._data,m=y.words,_=y.sigBytes,b=this.blockSize,x=b*4,B=_/x;s?B=f.ceil(B):B=f.max((B|0)-this._minBufferSize,0);var I=B*b,A=f.min(I*4,_);if(I){for(var M=0;M<I;M+=b)this._doProcessBlock(m,M);o=m.splice(0,I),y.sigBytes-=A}return new r.init(o,A)},clone:function(){var s=t.clone.call(this);return s._data=this._data.clone(),s},_minBufferSize:0});u.Hasher=a.extend({cfg:t.extend(),init:function(s){this.cfg=this.cfg.extend(s),this.reset()},reset:function(){a.reset.call(this),this._doReset()},update:function(s){return this._append(s),this._process(),this},finalize:function(s){s&&this._append(s);var o=this._doFinalize();return o},blockSize:16,_createHelper:function(s){return function(o,y){return new s.init(y).finalize(o)}},_createHmacHelper:function(s){return function(o,y){return new w.HMAC.init(s,y).finalize(o)}}});var w=l.algo={};return l}(Math);return e})}(de)),$}(function(n,i){(function(e,f){n.exports=f(Q())})(P,function(e){return function(f){var p=e,v=p.lib,F=v.WordArray,C=v.Hasher,l=p.algo,u=[],t=[];(function(){function d(w){for(var s=f.sqrt(w),o=2;o<=s;o++)if(!(w%o))return!1;return!0}function g(w){return(w-(w|0))*4294967296|0}for(var h=2,a=0;a<64;)d(h)&&(a<8&&(u[a]=g(f.pow(h,1/2))),t[a]=g(f.pow(h,1/3)),a++),h++})();var r=[],c=l.SHA256=C.extend({_doReset:function(){this._hash=new F.init(u.slice(0))},_doProcessBlock:function(d,g){for(var h=this._hash.words,a=h[0],w=h[1],s=h[2],o=h[3],y=h[4],m=h[5],_=h[6],b=h[7],x=0;x<64;x++){if(x<16)r[x]=d[g+x]|0;else{var B=r[x-15],I=(B<<25|B>>>7)^(B<<14|B>>>18)^B>>>3,A=r[x-2],M=(A<<15|A>>>17)^(A<<13|A>>>19)^A>>>10;r[x]=I+r[x-7]+M+r[x-16]}var X=y&m^~y&_,Y=a&w^a&s^w&s,ee=(a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22),te=(y<<26|y>>>6)^(y<<21|y>>>11)^(y<<7|y>>>25),D=b+te+X+t[x]+r[x],ne=ee+Y;b=_,_=m,m=y,y=o+D|0,o=s,s=w,w=a,a=D+ne|0}h[0]=h[0]+a|0,h[1]=h[1]+w|0,h[2]=h[2]+s|0,h[3]=h[3]+o|0,h[4]=h[4]+y|0,h[5]=h[5]+m|0,h[6]=h[6]+_|0,h[7]=h[7]+b|0},_doFinalize:function(){var d=this._data,g=d.words,h=this._nDataBytes*8,a=d.sigBytes*8;return g[a>>>5]|=128<<24-a%32,g[(a+64>>>9<<4)+14]=f.floor(h/4294967296),g[(a+64>>>9<<4)+15]=h,d.sigBytes=g.length*4,this._process(),this._hash},clone:function(){var d=C.clone.call(this);return d._hash=this._hash.clone(),d}});p.SHA256=C._createHelper(c),p.HmacSHA256=C._createHmacHelper(c)}(Math),e.SHA256})})(ue);const V=S;var N={},ge={get exports(){return N},set exports(n){N=n}};(function(n,i){(function(e,f){n.exports=f(Q())})(P,function(e){return function(){var f=e,p=f.lib,v=p.WordArray,F=f.enc;F.Base64={stringify:function(l){var u=l.words,t=l.sigBytes,r=this._map;l.clamp();for(var c=[],d=0;d<t;d+=3)for(var g=u[d>>>2]>>>24-d%4*8&255,h=u[d+1>>>2]>>>24-(d+1)%4*8&255,a=u[d+2>>>2]>>>24-(d+2)%4*8&255,w=g<<16|h<<8|a,s=0;s<4&&d+s*.75<t;s++)c.push(r.charAt(w>>>6*(3-s)&63));var o=r.charAt(64);if(o)for(;c.length%4;)c.push(o);return c.join("")},parse:function(l){var u=l.length,t=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var c=0;c<t.length;c++)r[t.charCodeAt(c)]=c}var d=t.charAt(64);if(d){var g=l.indexOf(d);g!==-1&&(u=g)}return C(l,u,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="};function C(l,u,t){for(var r=[],c=0,d=0;d<u;d++)if(d%4){var g=t[l.charCodeAt(d-1)]<<d%4*2,h=t[l.charCodeAt(d)]>>>6-d%4*2,a=g|h;r[c>>>2]|=a<<24-c%4*8,c++}return v.create(r,c)}}(),e.enc.Base64})})(ge);const G=N;function q(){return q=Object.assign?Object.assign.bind():function(n){for(var i=1;i<arguments.length;i++){var e=arguments[i];for(var f in e)Object.prototype.hasOwnProperty.call(e,f)&&(n[f]=e[f])}return n},q.apply(this,arguments)}function ye(n,i){if(n==null)return{};var e={},f=Object.keys(n),p,v;for(v=0;v<f.length;v++)p=f[v],!(i.indexOf(p)>=0)&&(e[p]=n[p]);return e}var k;(function(n){n[n.Hello=0]="Hello",n[n.Identify=1]="Identify",n[n.Identified=2]="Identified",n[n.Reidentify=3]="Reidentify",n[n.Event=5]="Event",n[n.Request=6]="Request",n[n.RequestResponse=7]="RequestResponse",n[n.RequestBatch=8]="RequestBatch",n[n.RequestBatchResponse=9]="RequestBatchResponse"})(k||(k={}));var J;(function(n){n[n.None=0]="None",n[n.General=1]="General",n[n.Config=2]="Config",n[n.Scenes=4]="Scenes",n[n.Inputs=8]="Inputs",n[n.Transitions=16]="Transitions",n[n.Filters=32]="Filters",n[n.Outputs=64]="Outputs",n[n.SceneItems=128]="SceneItems",n[n.MediaInputs=256]="MediaInputs",n[n.Vendors=512]="Vendors",n[n.Ui=1024]="Ui",n[n.All=1023]="All",n[n.InputVolumeMeters=65536]="InputVolumeMeters",n[n.InputActiveStateChanged=131072]="InputActiveStateChanged",n[n.InputShowStateChanged=262144]="InputShowStateChanged",n[n.SceneItemTransformChanged=524288]="SceneItemTransformChanged"})(J||(J={}));var K;(function(n){n[n.None=-1]="None",n[n.SerialRealtime=0]="SerialRealtime",n[n.SerialFrame=1]="SerialFrame",n[n.Parallel=2]="Parallel"})(K||(K={}));function Ce(n,i,e){const f=G.stringify(V(e+n));return G.stringify(V(f+i))}const me=["authentication","rpcVersion"],O=ce("obs-websocket-js");class H extends Error{constructor(i,e){super(e),this.code=void 0,this.code=i}}class L extends j{constructor(...i){super(...i),this._identified=!1,this.internalListeners=new j,this.socket=void 0}static generateMessageId(){return String(L.requestCounter++)}get identified(){return this._identified}async connect(i="ws://127.0.0.1:4455",e,f={}){var p=this;this.socket&&await this.disconnect();try{const v=this.internalEventPromise("ConnectionClosed"),F=this.internalEventPromise("ConnectionError");return await Promise.race([async function(){const C=await p.createConnection(i);return p.emit("Hello",C),p.identify(C,e,f)}(),new Promise((C,l)=>{F.then(u=>{u.message&&l(u)}),v.then(u=>{l(u)})})])}catch(v){throw await this.disconnect(),v}}async disconnect(){if(!this.socket||this.socket.readyState===U.CLOSED)return;const i=this.internalEventPromise("ConnectionClosed");this.socket.close(),await i}async reidentify(i){const e=this.internalEventPromise(`op:${k.Identified}`);return await this.message(k.Reidentify,i),e}async call(i,e){const f=L.generateMessageId(),p=this.internalEventPromise(`res:${f}`);await this.message(k.Request,{requestId:f,requestType:i,requestData:e});const{requestStatus:v,responseData:F}=await p;if(!v.result)throw new H(v.code,v.comment);return F}async callBatch(i,e={}){const f=L.generateMessageId(),p=this.internalEventPromise(`res:${f}`);await this.message(k.RequestBatch,q({requestId:f,requests:i},e));const{results:v}=await p;return v}cleanup(){this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket=void 0,this._identified=!1,this.internalListeners.removeAllListeners())}async createConnection(i){var e;const f=this.internalEventPromise("ConnectionOpened"),p=this.internalEventPromise(`op:${k.Hello}`);this.socket=new U(i,this.protocol),this.socket.onopen=this.onOpen.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this),this.socket.onclose=this.onClose.bind(this),await f;const v=(e=this.socket)==null?void 0:e.protocol;if(!v)throw new H(-1,"Server sent no subprotocol");if(v!==this.protocol)throw new H(-1,"Server sent an invalid subprotocol");return p}async identify(i,e,f={}){let{authentication:p,rpcVersion:v}=i,F=ye(i,me);const C=q({rpcVersion:v},f);p&&e&&(C.authentication=Ce(p.salt,p.challenge,e));const l=this.internalEventPromise(`op:${k.Identified}`);await this.message(k.Identify,C);const u=await l;return this._identified=!0,this.emit("Identified",u),q({rpcVersion:v},F,u)}async message(i,e){if(!this.socket)throw new Error("Not connected");if(!this.identified&&i!==1)throw new Error("Socket not identified");const f=await this.encodeMessage({op:i,d:e});this.socket.send(f)}async internalEventPromise(i){return new Promise(e=>{this.internalListeners.once(i,e)})}onOpen(i){O("socket.open"),this.emit("ConnectionOpened"),this.internalListeners.emit("ConnectionOpened",i)}async onMessage(i){try{const{op:e,d:f}=await this.decodeMessage(i.data);if(O("socket.message: %d %j",e,f),e===void 0||f===void 0)return;switch(e){case k.Event:{const{eventType:p,eventData:v}=f;this.emit(p,v);return}case k.RequestResponse:case k.RequestBatchResponse:{const{requestId:p}=f;this.internalListeners.emit(`res:${p}`,f);return}default:this.internalListeners.emit(`op:${e}`,f)}}catch(e){O("error handling message: %o",e)}}onError(i){O("socket.error: %o",i);const e=new H(-1,i.message);this.emit("ConnectionError",e),this.internalListeners.emit("ConnectionError",e)}onClose(i){O("socket.close: %s (%d)",i.reason,i.code);const e=new H(i.code,i.reason);this.emit("ConnectionClosed",e),this.internalListeners.emit("ConnectionClosed",e),this.cleanup()}}L.requestCounter=1;typeof exports<"u"&&Object.defineProperty(exports,"__esModule",{value:!0});class we extends L{constructor(...i){super(...i),this.protocol="obswebsocket.json"}async encodeMessage(i){return JSON.stringify(i)}async decodeMessage(i){return JSON.parse(i)}}let Fe=Z(!1),be=Z(new we);export{be as a,Fe as o};
